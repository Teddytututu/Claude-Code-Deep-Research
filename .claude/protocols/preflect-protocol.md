# PreFlect Protocol v1.0

PreFlect = Pre-execution Reflection (äº‹å‰åæ€)

å°†åæ€èŒƒå¼ä»**å›æº¯å¼**ç¿»è½¬ä¸º**å‰ç»å¼**ï¼Œåœ¨æ‰§è¡Œå‰é¢„é˜²å¸¸è§é”™è¯¯ã€‚

---

## Core Principle

```
ä¼ ç»Ÿæµç¨‹: æ‰§è¡Œ â†’ å¤±è´¥ â†’ åæ€ â†’ ä¿®å¤ï¼ˆæµªè´¹æ—¶é—´ï¼‰
PreFlect: å‰ç»æ‰¹è¯„ â†’ ç²¾åŒ–è®¡åˆ’ â†’ æ‰§è¡Œï¼ˆé¢„é˜²é”™è¯¯ï¼‰
```

**å…³é”®æ´å¯Ÿ**: å¤§å¤šæ•°ç ”ç©¶é”™è¯¯æœ‰å¯é¢„æµ‹çš„æ¨¡å¼ã€‚é€šè¿‡å‰ç»æ€§æ‰¹è¯„ï¼Œå¯ä»¥åœ¨æ‰§è¡Œå‰è¯†åˆ«å¹¶é¢„é˜²è¿™äº›é”™è¯¯ã€‚

---

## Trigger Conditions / è§¦å‘æ¡ä»¶

| è§¦å‘æ—¶æœº | æ‰§è¡Œè€… | å¿…è¦æ¡ä»¶ |
|---------|--------|---------|
| Subagent æ”¶åˆ°ä»»åŠ¡å | Subagent | **æ¯æ¬¡ä»»åŠ¡æ‰§è¡Œå‰å¼ºåˆ¶æ‰§è¡Œ** |
| ä»»åŠ¡ç»­ä¼ æ—¶ | Subagent | åŠ è½½å†å² PreFlect è®°å½• |

---

## Execution Flow / æ‰§è¡Œæµç¨‹

### Step 1: Load Historical Failure Patterns

```python
def load_failure_patterns():
    """åŠ è½½å†å²å¤±è´¥æ¨¡å¼æ‘˜è¦"""
    patterns_file = ".claude/knowledge/reflections/summary.md"

    # è¯»å–ä¸æœ¬ä»»åŠ¡ç±»å‹ç›¸å…³çš„é£é™©æ¨¡å¼
    relevant_patterns = filter_patterns_by_task_type(
        patterns_file,
        task_type=current_task.type
    )

    return relevant_patterns
```

### Step 2: Prospective Criticism (å‰ç»æ€§æ‰¹è¯„)

è¾“å‡ºä»¥ä¸‹ç»“æ„ï¼š

```json
{
  "preflect_id": "pf_20260221_001",
  "timestamp": "2026-02-21T10:30:00Z",
  "agent_type": "academic-researcher",
  "task_summary": "æ”¶é›† multi-agent orchestration ç›¸å…³è®ºæ–‡",

  "plan_risks": [
    {
      "risk": "æœç´¢è¯è¿‡çª„",
      "evidence": "å†å²å¤±è´¥æ¨¡å¼ï¼šå¤šæ¬¡ä»…ç”¨å•ä¸€å…³é”®è¯æœç´¢å¯¼è‡´ç»“æœä¸è¶³",
      "severity": "high"
    },
    {
      "risk": "è¿‡æ—©åœæ­¢",
      "evidence": "å†å²å¤±è´¥æ¨¡å¼ï¼šåœ¨æ”¶é›†åˆ° 3 ç¯‡è®ºæ–‡ååœæ­¢ï¼Œæœªè¾¾æœ€å°è¦æ±‚",
      "severity": "critical"
    }
  ],

  "high_priority_risks": [
    "è¿‡æ—©åœæ­¢ - å¿…é¡»åœ¨å¼€å§‹æ—¶è®¾ç½®æ•°é‡ç›®æ ‡"
  ],

  "mitigation_plan": {
    "æœç´¢è¯è¿‡çª„": "ä½¿ç”¨ 3+ ä¸ªç›¸å…³åˆ†ç±»ï¼Œå°è¯•åŒä¹‰è¯æ‰©å±•",
    "è¿‡æ—©åœæ­¢": "è®¾ç½®æ˜ç¡®çš„æ•°é‡ç›®æ ‡ï¼ˆâ‰¥5 papersï¼‰ï¼Œåœ¨è¿‡ç¨‹ä¸­æ£€æŸ¥"
  },

  "refined_search_strategy": [
    "1. åŒæ—¶æœç´¢ cs.AI, cs.LG, cs.MA åˆ†ç±»",
    "2. ä½¿ç”¨å¤šç§æœç´¢è¯ç»„åˆ",
    "3. è®¾ç½®ä¸­æœŸæ£€æŸ¥ç‚¹ï¼ŒéªŒè¯æ•°é‡æ˜¯å¦è¾¾æ ‡"
  ]
}
```

### Step 3: Refined Plan (ç²¾åŒ–è®¡åˆ’)

åŸºäºæ‰¹è¯„ç»“æœï¼Œè¾“å‡ºä¿®è®¢ç‰ˆè®¡åˆ’ï¼š

```markdown
## Refined Execution Plan

### Original Plan
- æœç´¢ multi-agent ç›¸å…³è®ºæ–‡
- ä¸‹è½½å…¨æ–‡
- åˆ†æå¼•ç”¨é“¾

### Identified Risks
1. æœç´¢è¯è¿‡çª„ â†’ ä½¿ç”¨å¤šåˆ†ç±»æœç´¢
2. è¿‡æ—©åœæ­¢ â†’ è®¾ç½®ä¸­æœŸæ£€æŸ¥ç‚¹

### Refined Plan
1. **Broad Search Phase**
   - æœç´¢è¯: "multi-agent orchestration", "agent coordination", "hierarchical agents"
   - åˆ†ç±»: cs.AI, cs.LG, cs.MA, cs.CL
   - ç›®æ ‡: â‰¥15 ç¯‡å€™é€‰è®ºæ–‡

2. **Quality Filter Phase**
   - ç­›é€‰æ¡ä»¶: citations > 20 OR 2024+ æ–°è®ºæ–‡
   - ç›®æ ‡: â‰¥5 ç¯‡æ ¸å¿ƒè®ºæ–‡

3. **Mid-Process Checkpoint** (åœ¨å¤„ç† 3 ç¯‡å)
   - æ£€æŸ¥: æ˜¯å¦è¾¾åˆ°æœ€å°è¦æ±‚ï¼Ÿ
   - å¦‚æœæœªè¾¾æ ‡: è°ƒæ•´æœç´¢ç­–ç•¥
```

### Step 4: Execute with Monitoring

æ‰§è¡Œç²¾åŒ–åçš„è®¡åˆ’ï¼Œå¹¶åœ¨ä»¥ä¸‹æƒ…å†µè§¦å‘åŠ¨æ€é‡è§„åˆ’ï¼š

| è§¦å‘æ¡ä»¶ | åŠ¨ä½œ |
|---------|------|
| å·¥å…·è°ƒç”¨è¿”å›é¢„æœŸå¤–æ•°æ®æ ¼å¼ | é‡æ–°è¯„ä¼°æœç´¢ç­–ç•¥ |
| èµ„æºæ¶ˆè€—é€Ÿåº¦è¶…è¿‡é¢„æœŸ 2 å€ | è¿›å…¥åŠ é€Ÿæ¨¡å¼ |
| å‘ç°æ–°ä¿¡æ¯ä½¿åŸè®¡åˆ’å‡è®¾å¤±æ•ˆ | è°ƒæ•´ä¼˜å…ˆçº§ |

---

## Risk Patterns by Task Type / æŒ‰ä»»åŠ¡ç±»å‹çš„é£é™©æ¨¡å¼

### Academic Research Tasks

| é£é™© | å‰ç»æ£€æŸ¥ | é¢„é˜²æªæ–½ |
|------|---------|---------|
| æœç´¢è¯è¿‡çª„ | æ˜¯å¦è¦†ç›– 3+ ä¸ªç›¸å…³åˆ†ç±»ï¼Ÿ | ä½¿ç”¨åˆ†ç±»ç»„åˆæœç´¢ |
| è¿‡æ—©åœæ­¢ | æ˜¯å¦è®¾ç½®äº†æ•°é‡ç›®æ ‡ï¼ˆâ‰¥5ï¼‰ï¼Ÿ | è®¾ç½®ä¸­æœŸæ£€æŸ¥ç‚¹ |
| é—æ¼å¼•ç”¨é“¾ | æ˜¯å¦è®¡åˆ’è¿½è¸ª key paper çš„ citationsï¼Ÿ | æ·»åŠ  citation tracking æ­¥éª¤ |
| ä»…æ”¶é›†æ–°è®ºæ–‡ | æ˜¯å¦æ£€æŸ¥äº†åŸºç¡€è®ºæ–‡ï¼Ÿ | æŒ‰å¼•ç”¨é‡æ’åºï¼Œè¿½è¸ªæ ¹æº |

### GitHub Project Tasks

| é£é™© | å‰ç»æ£€æŸ¥ | é¢„é˜²æªæ–½ |
|------|---------|---------|
| ä»…ç”¨å…³é”®è¯æœç´¢ | æ˜¯å¦åŒæ—¶ç”¨ topicsã€stars ç­›é€‰ï¼Ÿ | å¤šç»´åº¦æœç´¢ |
| é—æ¼ç›¸å…³å®ç° | æ˜¯å¦æ£€æŸ¥äº† key paper å¯¹åº”çš„å¼€æºå®ç°ï¼Ÿ | è®ºæ–‡â†’ä»£ç å…³è”æ£€æŸ¥ |
| ä½è´¨é‡é¡¹ç›® | æ˜¯å¦è®¾ç½®äº† stars é˜ˆå€¼ï¼Ÿ | stars > 100 ç­›é€‰ |
| å¿½ç•¥æ¶æ„å·®å¼‚ | æ˜¯å¦è®¡åˆ’è¯†åˆ«æŠ€æœ¯æµæ´¾ï¼Ÿ | æ¶æ„æ¨¡å¼æå–æ­¥éª¤ |

### Community Discussion Tasks

| é£é™© | å‰ç»æ£€æŸ¥ | é¢„é˜²æªæ–½ |
|------|---------|---------|
| å…±è¯†ç‚¹è¯†åˆ«ä¸è¶³ | æ˜¯å¦è®¡åˆ’æ¯ 5 ä¸ªå¸–å­æç‚¼ä¸€æ¬¡å…±è¯†ï¼Ÿ | æ‰¹é‡å¤„ç†+å…±è¯†æå– |
| å¹³å°å•ä¸€ | æ˜¯å¦è¦†ç›– Reddit + HN + ä¸­æ–‡ç¤¾åŒºï¼Ÿ | å¤šå¹³å°å¹¶è¡Œæœç´¢ |
| ç†è®º > å®è·µ | æ˜¯å¦å…³æ³¨å®è·µè€…è§‚ç‚¹ï¼Ÿ | ç­›é€‰é«˜äº’åŠ¨å¸–å­ |
| é—æ¼äº‰è®®ç‚¹ | æ˜¯å¦è®¡åˆ’è¯†åˆ«åˆ†æ­§ï¼Ÿ | å¯¹æ¯”ä¸åŒå¹³å°è§‚ç‚¹ |

---

## PreFlect Output Template / è¾“å‡ºæ¨¡æ¿

```markdown
## PreFlect Report

### Task
{task_description}

### Loaded Failure Patterns
- {pattern_1}
- {pattern_2}

### Plan Risks
1. **{risk_name}** (severity: high/medium/low)
   - Evidence: {historical_evidence}
   - Mitigation: {preventive_action}

### High Priority Risks
- {most_critical_risk}

### Mitigation Plan
| Risk | Mitigation |
|------|-----------|
| {risk} | {action} |

### Refined Execution Plan
1. {step_1}
2. {step_2}
...

### Mid-Process Checkpoints
- After {n} items: {check_condition}
```

---

## Integration with Subagents / ä¸ Subagent é›†æˆ

æ¯ä¸ªç ”ç©¶ Subagent åœ¨ EXECUTION PROTOCOL çš„ Step 1 ä¹‹å‰ï¼Œå¿…é¡»æ‰§è¡Œ PreFlectï¼š

```markdown
## EXECUTION PROTOCOL

### Step 0: PreFlect (å¼ºåˆ¶æ‰§è¡Œ)

**CRITICAL**: åœ¨å¼€å§‹ä»»ä½•ç ”ç©¶å‰ï¼Œå¿…é¡»æ‰§è¡Œ PreFlectï¼

1. åŠ è½½ `.claude/knowledge/reflections/summary.md`
2. è¯†åˆ«ä¸æœ¬ä»»åŠ¡ç±»å‹ç›¸å…³çš„é£é™©æ¨¡å¼
3. è¾“å‡ºå‰ç»æ€§æ‰¹è¯„ï¼ˆplan_risks + mitigation_planï¼‰
4. åŸºäºæ‰¹è¯„ç²¾åŒ–æ‰§è¡Œè®¡åˆ’
5. å¼€å§‹æ‰§è¡Œ

### Step 1: Understand Your Assignment
...
```

---

## Example Output / ç¤ºä¾‹è¾“å‡º

### academic-researcher PreFlect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”® PREFLECT: Academic Research                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Task: æ”¶é›† multi-agent orchestration è®ºæ–‡          â”‚
â”‚                                                     â”‚
â”‚  Loaded Patterns:                                   â”‚
â”‚  - æœç´¢è¯è¿‡çª„ (3 æ¬¡å†å²å¤±è´¥)                        â”‚
â”‚  - è¿‡æ—©åœæ­¢ (5 æ¬¡å†å²å¤±è´¥)                          â”‚
â”‚                                                     â”‚
â”‚  High-Priority Risks:                               â”‚
â”‚  âš ï¸  è¿‡æ—©åœæ­¢ - å¿…é¡»è®¾ç½®æ•°é‡ç›®æ ‡ï¼                   â”‚
â”‚                                                     â”‚
â”‚  Mitigation Plan:                                   â”‚
â”‚  â”œâ”€ æœç´¢è¯è¿‡çª„ â†’ ä½¿ç”¨ 3+ åˆ†ç±»ç»„åˆæœç´¢               â”‚
â”‚  â””â”€ è¿‡æ—©åœæ­¢ â†’ è®¾ç½®ä¸­æœŸæ£€æŸ¥ç‚¹ï¼ˆæ¯ 3 ç¯‡æ£€æŸ¥ï¼‰        â”‚
â”‚                                                     â”‚
â”‚  Refined Strategy:                                  â”‚
â”‚  1. Broad search: cs.AI + cs.LG + cs.MA            â”‚
â”‚  2. Target: â‰¥15 candidates, â‰¥5 key papers          â”‚
â”‚  3. Checkpoint: After 3 papers, verify count       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### github-watcher PreFlect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”® PREFLECT: GitHub Watcher                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Task: è°ƒç ” multi-agent æ¡†æ¶å¼€æºå®ç°                â”‚
â”‚                                                     â”‚
â”‚  Loaded Patterns:                                   â”‚
â”‚  - ä»…ç”¨å…³é”®è¯æœç´¢ (2 æ¬¡å†å²å¤±è´¥)                    â”‚
â”‚  - é—æ¼ç›¸å…³å®ç° (4 æ¬¡å†å²å¤±è´¥)                      â”‚
â”‚                                                     â”‚
â”‚  High-Priority Risks:                               â”‚
â”‚  âš ï¸  é—æ¼ç›¸å…³å®ç° â†’ æ£€æŸ¥è®ºæ–‡å¯¹åº”çš„å¼€æºé¡¹ç›®ï¼         â”‚
â”‚                                                     â”‚
â”‚  Mitigation Plan:                                   â”‚
â”‚  â”œâ”€ å•ä¸€æœç´¢ â†’ å¤šç»´åº¦: keywords + topics + stars   â”‚
â”‚  â””â”€ é—æ¼å®ç° â†’ æ£€æŸ¥ academic paper çš„ GitHub link  â”‚
â”‚                                                     â”‚
â”‚  Refined Strategy:                                  â”‚
â”‚  1. Search: topics:"multi-agent" stars:>100        â”‚
â”‚  2. Cross-check: Papers from academic-researcher   â”‚
â”‚  3. Target: â‰¥8 projects, â‰¥4 deep analysis          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### community-listener PreFlect

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”® PREFLECT: Community Listener                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Task: æ”¶é›† multi-agent ç¤¾åŒºè®¨è®ºå’Œå®è·µåé¦ˆ          â”‚
â”‚                                                     â”‚
â”‚  Loaded Patterns:                                   â”‚
â”‚  - å…±è¯†ç‚¹è¯†åˆ«ä¸è¶³ (3 æ¬¡å†å²å¤±è´¥)                    â”‚
â”‚  - å¹³å°å•ä¸€ (2 æ¬¡å†å²å¤±è´¥)                          â”‚
â”‚                                                     â”‚
â”‚  High-Priority Risks:                               â”‚
â”‚  âš ï¸  å…±è¯†ç‚¹è¯†åˆ«ä¸è¶³ â†’ æ¯ 5 ä¸ªå¸–å­æç‚¼ä¸€æ¬¡ï¼          â”‚
â”‚                                                     â”‚
â”‚  Mitigation Plan:                                   â”‚
â”‚  â”œâ”€ å¹³å°å•ä¸€ â†’ Reddit + HN + çŸ¥ä¹ + æ˜é‡‘           â”‚
â”‚  â””â”€ å…±è¯†ä¸è¶³ â†’ æ‰¹é‡å¤„ç†ï¼Œå®šæœŸæç‚¼                   â”‚
â”‚                                                     â”‚
â”‚  Refined Strategy:                                  â”‚
â”‚  1. Parallel search: 4 platforms                   â”‚
â”‚  2. Consensus extraction: Every 5 discussions      â”‚
â”‚  3. Target: â‰¥15 discussions, â‰¥3 consensus points   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Quality Checklist / è´¨é‡æ£€æŸ¥

### PreFlect Report Quality

- [ ] åŒ…å« preflect_id
- [ ] åŒ…å« timestamp
- [ ] åŠ è½½äº†å†å²å¤±è´¥æ¨¡å¼
- [ ] plan_risks è‡³å°‘è¯†åˆ« 2 ä¸ªé£é™©
- [ ] high_priority_risks è¯†åˆ«äº†æœ€å±é™©çš„é£é™©
- [ ] mitigation_plan ä¸ºæ¯ä¸ªé£é™©æä¾›äº†é¢„é˜²æªæ–½
- [ ] refined_search_strategy æœ‰å…·ä½“çš„æ‰§è¡Œæ­¥éª¤

---

## CHANGELOG

### v1.0 (2026-02-21)

**Initial Release**:
- å‰ç»æ€§æ‰¹è¯„æµç¨‹
- æŒ‰ä»»åŠ¡ç±»å‹çš„é£é™©æ¨¡å¼åº“
- PreFlect è¾“å‡ºæ¨¡æ¿
- ä¸ Subagent çš„é›†æˆæ–¹æ¡ˆ
- åŠ¨æ€é‡è§„åˆ’è§¦å‘æ¡ä»¶
